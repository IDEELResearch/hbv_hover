---
title: "Vérification des données d'HOVER"
author: "Camille Morgan"
date: "7 Nov 2022"

output:
  html_document:
    body_placement: left
    code_folding: hide
    toc_float:                                                             
      collapse: true                                                      
      smooth_scroll: true 
header-includes:
  - \usepackage{titling}
  - \pretitle{\begin{flushleft}}
  - \posttitle{\end{flushleft}}
---
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(dplyr.summarise.inform = FALSE)
library(tidyverse)

#data
#inddata1 <- saveRDS(inddata1, "/Users/camillem/OneDrive - University of North Carolina at Chapel Hill/Epi PhD/IDEEL/HepB/HOVER/hoverdataanalysis/inddata.RDS")

inddata1_dc <- readRDS("/Users/camillem/OneDrive - University of North Carolina at Chapel Hill/Epi PhD/IDEEL/HepB/HOVER/hoverdataanalysis/inddata.RDS")
```

### Vérification des données

#### Distribution d'age par relation avec la mère index

```{r echo=FALSE, echo=TRUE}
ggplot(inddata1_dc, aes(x = age_combined)) + geom_histogram() +facet_wrap( ~ hr3_relationship_f)
ggplot(inddata1_dc, aes(x = age_combined)) + geom_boxplot() +facet_wrap( ~ hr3_relationship_f)
```

#### Grandparents
##### Les participants marqués comme grands-parents avec un âge < 45 ans

```{r echo=FALSE, echo=TRUE}
## grandparents-----
#below age 45 - 1 household
inddata1_dc %>% filter(hr3_relationship == 13 & age_combined < 45) %>% summarise(hrhhid, participant_code, age_combined,hr4_sex_f,hrname_last, hrname_post, hrname_first,hr3_relationship_f) # 

```

#### Maris
##### Les participants marqués comme mari avec un âge hors de la limite

```{r echo=FALSE, out.width="50%", echo=TRUE}
## mari-------- 
inddata1_dc %>% filter(hr3_relationship == 2) %>% summarise(min(age_combined), max(age_combined))
inddata1_dc %>% filter(hr3_relationship == 2 & age_combined < 22) %>% summarise(hrhhid, participant_code, age_combined,hr4_sex_f,hrname_last, hrname_post, hrname_first,hr3_relationship_f) # 

```

#### Mères indexes

```{r echo=FALSE, out.width="50%", echo=TRUE}
## index mother------
inddata1_dc %>% filter(hr3_relationship == 1) %>% summarise(min(age_combined), max(age_combined))

inddata1_dc %>% filter(hr3_relationship == 1 & age_combined < 20) %>% summarise(hrhhid, participant_code, age_combined,hr4_sex_f,hrname_last, hrname_post, hrname_first) # 

# inddata1_dc %>% filter(hr3_relationship == 1 & age_combined > 40) %>% summarise(hrhhid, participant_code, age_combined,hr4_sex_f,hrname_last, hrname_post, hrname_first) # 

# use 01_datacleaning.R to find agediff created

```

##### Différences d'âge entre la mère index et les enfants qui sont en dehors de la limite

```{r echo=FALSE, out.width="30%", echo=TRUE}
#evaluate non-logical age differences 
# most concerning
inddata1_dc %>% filter(hr3_relationship == 3 & agediff < 15) %>% summarise(hrhhid, participant_code, age_combined, indexmotherage, agediff,hr4_sex_f,hrname_last, hrname_post, hrname_first) # 

```

#### Parents
##### âge des parents proche de la limite d'une limite appropriée

```{r echo=FALSE, out.width="30%", echo=TRUE}
## parents-------
inddata1_dc %>% filter(hr3_relationship == 6 & age_combined < 50) %>% summarise(hrhhid, participant_code, hr3_relationship_f,hr4_sex_f,age_combined,hrname_last, hrname_post, hrname_first) # 
```

#### Petits-enfants

```{r echo=FALSE, out.width="30%", echo=TRUE}
## grandchildren
inddata1_dc %>% filter(hr3_relationship == 5) %>% summarise(min(age_combined), max(age_combined))
# see 01_datacleaning for agediff_grands variable

table(inddata1_dc$agediff_grands)

inddata1_dc %>% filter(hr3_relationship == 5) %>% summarise(hrhhid, participant_code, age_combined, indexmotherage, agediff_grands,hr4_sex_f,hrname_last, hrname_post, hrname_first,hr3_relationship_f) # 

```

#### Tante/oncle
```{r echo=FALSE, out.width="30%", echo=TRUE}
## aunts/uncles
inddata1_dc %>% filter(hr3_relationship == 12) %>% summarise(min(age_combined), max(age_combined))

inddata1_dc %>% filter(hr3_relationship == 12) %>% summarise(hrhhid, participant_code, age_combined, indexmotherage,hr4_sex_f,hrname_last, hrname_post, hrname_first,hr3_relationship_f) # 

```

#### Frères et soeurs

##### L'âge des frères et sœurs si l'âge est inférieur à 10 ans
```{r echo=FALSE, out.width="30%", echo=TRUE}
## aunts/uncles
inddata1_dc %>% filter(hr3_relationship == 8) %>% summarise(min(age_combined), max(age_combined))

inddata1_dc %>% filter(hr3_relationship == 8 & age_combined < 10) %>% summarise(hrhhid, participant_code, age_combined, indexmotherage,hr4_sex_f,hrname_last, hrname_post, hrname_first) # 
```

#### Les ménages de ceux qui ont des frères et sœurs ont moins de 10 ans.
#### HRB-1035
```{r echo=FALSE, out.width="30%", echo=TRUE}
inddata1_dc %>% filter(hrhhid == "HRB-1035") %>% summarise(hr3_relationship_f,age_combined, hr4_sex_f, i27a_rdt_result_f, hrname_last, hrname_post, hrname_first,hrhhid, participant_code )
```
#### HRB-1083
```{r echo=FALSE, out.width="30%", echo=TRUE}
inddata1_dc %>% filter(hrhhid == "HRB-1083") %>% summarise(hr3_relationship_f,age_combined, hr4_sex_f, i27a_rdt_result_f, hrname_last, hrname_post, hrname_first,hrhhid, participant_code ) %>% arrange(desc(hr3_relationship_f))
```
#### HRK-2018
```{r echo=FALSE, out.width="30%", echo=TRUE}
inddata1_dc %>% filter(hrhhid == "HRK-2018") %>% summarise(hr3_relationship_f,age_combined, hr4_sex_f, i27a_rdt_result_f, hrname_last, hrname_post, hrname_first,hrhhid, participant_code ) %>% arrange(desc(hr3_relationship_f))
```
#### HRK2023
```{r echo=FALSE, out.width="30%", echo=TRUE}
inddata1_dc %>% filter(hrhhid == "HRK2023") %>% summarise(hr3_relationship_f,age_combined, hr4_sex_f, i27a_rdt_result_f, hrname_last, hrname_post, hrname_first,hrhhid, participant_code ) %>% arrange(desc(hr3_relationship_f))
```

##### HRK2077: le frère doit-il être un fils ? 
```{r echo=FALSE, out.width="30%", echo=TRUE}
inddata1_dc %>% filter(hrhhid == "HRK2077") %>% summarise(hr3_relationship_f,age_combined, hr4_sex_f, i27a_rdt_result_f, hrname_last, hrname_post, hrname_first,hrhhid, participant_code ) %>% arrange(desc(hr3_relationship_f))
```

##### HRK-2002 figure sur plusieurs de ces chèques.
##### 1) l'âge de la mère index semble incorrect - elle a des enfants plus âgés qu'elle
##### 2) il y a 3 parents - l'un d'eux est-il le mari ?
##### 3) Est-il exact qu'il y a deux petits-enfants de la mère index ?
```{r echo=FALSE, out.width="30%", echo=TRUE}
inddata1_dc %>% filter(hrhhid == "HRK-2002") %>% summarise(hr3_relationship_f,age_combined, hr4_sex_f, agediff,agediff_grands )

```

#### Beaux-parents

##### âge des parents proche de la limite d'une limite appropriée


```{r echo=FALSE, out.width="30%", echo=TRUE}
## aunts/uncles
inddata1_dc %>% filter(hr3_relationship == 7) %>% summarise(min(age_combined), max(age_combined))

inddata1_dc %>% filter(hr3_relationship == 7 & age_combined < 40) %>% summarise(hrhhid, participant_code, age_combined, indexmotherage,hr4_sex_f,hrname_last, hrname_post, hrname_first) # 
```

##### HRK-2018-04 est âgée de 18 ans mais est marquée comme belle-mère

```{r echo=FALSE, out.width="30%", echo=TRUE}
inddata1_dc %>% filter(hrhhid == "HRK-2018") %>% summarise(hr3_relationship_f,age_combined, hr4_sex_f, i27a_rdt_result_f, hrname_last, hrname_post, hrname_first,hrhhid, participant_code ) %>% arrange(desc(hr3_relationship_f))
```

##### HRK-2011-05 est âgée de 2 ans mais est marquée comme belle-mère

```{r echo=FALSE, out.width="30%", echo=TRUE}
inddata1_dc %>% filter(hrhhid == "HRK2011") %>% summarise(hr3_relationship_f,age_combined, hr4_sex_f, i27a_rdt_result_f, hrname_last, hrname_post, hrname_first,hrhhid, participant_code ) %>% arrange(desc(hr3_relationship_f))

```

##### HRK-2015
La mère a 40 ans, le mari a 27 ans, et l'aîné des enfants a 17 ans (le mari avait donc 10 ans à sa naissance). Le mari doit-il avoir 37 ou 47 ans ?
```{r echo=FALSE, out.width="30%", echo=TRUE}
inddata1_dc %>% filter(hrhhid == "HRK2015") %>% summarise(hr3_relationship_f,age_combined, hr4_sex_f, i27a_rdt_result_f, hrname_last, hrname_post, hrname_first,hrhhid, participant_code ) %>% arrange(desc(hr3_relationship_f))
```

##### HRK-1008
La mère indexée a 39 ans, le mari 71 ans. 
1) Est l'âge du mari (71 ans) correct ?
2) Si c'est le cas, tous les enfants du ménage sont-ils les siens ou ceux d'une autre femme du mari ?
```{r echo=FALSE, out.width="30%", echo=TRUE}
inddata1_dc %>% filter(hrhhid == "HRB-1008") %>% summarise(hr3_relationship_f,age_combined, hr4_sex_f, i27a_rdt_result_f, hrname_last, hrname_post, hrname_first,hrhhid, participant_code ) %>% arrange(desc(hr3_relationship_f))
```

### HBsAg resultats
#### HRK-2043
Dans les données HOVER, toutes les soeurs sont positives et tous les frères sauf un sont positifs, mais lors de la visite à Fogarty, la famille a déclaré que les sœurs étaient auparavant négatives et que tous les frères étaient positifs.
```{r echo=FALSE, out.width="30%", echo=TRUE}
inddata1_dc %>% filter(hrhhid == "HRK2043") %>% summarise(hr3_relationship_f,age_combined, hr4_sex_f, i27a_rdt_result_f, hrname_last, hrname_post, hrname_first,hrhhid, participant_code ) %>% arrange(desc(hr3_relationship_f))
```

### Pouvez-vous penser à des cas où un participant inscrit était l'enfant du mari, mais où la mère indexée n'était pas la mère biologique de l'enfant ?


#### list de mere index des ces menages avec une question
```{r echo=FALSE, out.width="30%", eval=F}
all_issues <- data.frame(c("HRK2041","HRK2009","HRB-1049","HRK-2002","HRB -1012", "HRK-2001", "HRK2033", "HRK2045", "HRK2056", "HRK2059", "HRK2081", "HRB-1008", "HRB-1025", "HRK2015", "HRK2031", "HRK2064", "HRB-1024", "HRB-1083", "HRK-2026", "HRK2008", "HRK2014", "HRK2023", "HRK2064", "HRK2091", "HRK2092", "HRB-1035", "HRK-2018", "HRK2023", "HRK2077", "HRK2011", "HRK2043"))
colnames(all_issues) <- c("hrhhid")

miref <- inddata1 %>% filter(hr3_relationship==1 & (hrhhid %in% all_issues$hrhhid)) %>% select("hrhhid","participant_code","hdov","h10_hbv_rdt","n","hr3_relationship_f","age_combined", "i27a_rdt_result_f","hrname_last", "hrname_post", "hrname_first")


# check that difference in dataframe size is due to duplicates
miss <- all_issues %>% filter(!(hrhhid %in% miref$hrhhid))
length(unique(all_issues$hrhhid))
hhdata1$hxcoord_edit
# add GPS points
miref <- left_join(miref, hhdata1[,c("hrhhid","hxcoord_edit","hycoord_edit")], by = "hrhhid")

## ADD ACQ IDs


options(scipen = 999)
library(sf)
library(tmap)    # for static and interactive maps
library(leaflet) # for interactive maps
library(tmaptools)
library(OpenStreetMap)

datacheckgps = st_as_sf(miref, coords = c("hycoord_edit", "hxcoord_edit"), crs = 4326)  
tmap_mode("view")
# tmap_mode("plot")
tm_basemap("OpenStreetMap") +
  tm_shape(st_jitter(datacheckgps, factor=0.005)) + 
    tm_dots(col = as.factor("h10_hbv_rdt"),id="hrhhid")



```




